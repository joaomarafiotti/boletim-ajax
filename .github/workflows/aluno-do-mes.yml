name: Aluno do Mês

on:
  push:

jobs:
  aluno-top:
    runs-on: ubuntu-latest
    steps:
      - name: Chamar API e comentar no commit
        run: |
          # Instala o jq
          sudo apt-get update && sudo apt-get install -y jq

          # Chama a API e guarda o aluno com maior média
          top_aluno=$(curl -s https://ifsp.ddns.net/webservices/boletim/aluno | jq -r '
            max_by(.media) as $melhor |
            "🏆 Aluno do mês: \($melhor.nome) — Média: \($melhor.media)"')

          echo "$top_aluno"

          # Comenta no commit atual
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git clone https://github.com/${{ github.repository }} repo
          cd repo
          git checkout ${{ github.ref_name }}
          echo "$top_aluno" >> aluno_do_mes.txt
          git add aluno_do_mes.txt
          git commit -m "$top_aluno"
          git push
